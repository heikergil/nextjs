name: E2E Tests
on: workflow_dispatch

jobs:
   E2E-Tests:
    if: github.event.deployment_status.state == 'success' 
    timeout-minutes: 30
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v2
      with:
        node-version: '18.x'


    - name: Cache node_modules
      uses: actions/cache@v3
      id: cache-node-modules
      with:
        path: '**/node_modules'
        key: ${{ hashFiles('**/yarn.lock') }}

    - name: Cache Playwright
      uses: actions/cache@v3
      with:
          path: |
              ~/.cache/ms-playwright
          key: playwright-${{ hashFiles('yarn.lock') }}

    - name: Install pakages
      if: steps.cache-node-modules.outputs.cache-hit != 'true'
      run: yarn

    - name: Install Playwright 
      run: npx playwright install --with-deps chromium

    - name: Run Playwright tests
      env: 
        BASE_URL: ${{ github.event.deployment_status.target_url }}
      run: yarn playwright test
    - uses: actions/upload-artifact@v2
      if: always()
      with:
        name: playwright-report
        path: playwright-report/
        retention-days: 3    
 
 
    
